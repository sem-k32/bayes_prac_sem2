# Построение коллажа из двух изображений

## а)

Сделанные фото находятся в ``` data/ ```

## б)-в)

Система соседства: для данного пикселя берём пиксели слева, справа, снизу, сверху (на краях изображения некоторые варинаты будут отпадать). Брать больше соседей не принципиально, хотя возможно вплоть до всех пискелей в данной прямоугольной окрестности. Это усложнит граф и увеличит время поиска разреза.

Т.к. у нас нет для фотографий коллажа никаких индивидуальных априорных предположений, т.е. предпочтений насчёт какое фото "более важное", то одиночные потенциалы взяты за константу $ = 0 $. Но не все, т.к. необходимо определить какие-то начальные участки двух фотографий, которые обязательно должны быть включены в коллаж. Для этого делаем в нужных пикселях одиночный потенциал другой фотографии бесконечно большим:

$$
    \Theta_i(x_i) = \infty, \ x_i \in \{0, 1\}
$$

Т.к. мы минимизируем суммарную энергию, то в данном пискеле всегда будет выбрано нужное фото. Если не задать начальные участки для коллажа, то, скорей всего, минимизация $E$ приведёт к элементарному коллажу-копии одного из фото. Чтобы этого не произошло, парные потенциалы не должны везде поощрять равнество соседних пискелей больше, чем их различие, а нам хотелось бы сохранить это.

Для работы GraphCut необходимо выполнение условия субмодулярности парных потенциалов. Далее, имея начальные приближения коллажа в виде унарных потенциалов, у нас уже имеется некая граница двух классов. После заполнения классами оставшимися пикселями граница классов останется. Т.о. парный потенциал должен давать наименьший штраф перехода классов в той части изображений, где они изображения наиболее похожи. В этом случае граница классов будет незаметной, а коллаж правдоподобным для человека. Вне границы классов, соседние пиксели должны приходить из одного фото, поэтому нам пригодится модель Поттса.

Похожесть пикселей выражется $ \rho = \lVert \text{pix}(x_i) - \text{pix}(x_j) \rVert $ их нормой разности в RGB представлении, соответственно для потенциала достаточно взять любую возрастающую от этой метрики. В работе были выбраны $ f(\rho) = \exp(\lambda \rho) $ и $ f(\rho) = \rho^{\alpha} $. Итоговый потенциал:

$$
    \Theta_{ij}(x_i, x_j) = f(\lVert \text{pix}(x_i) - \text{pix}(x_j) \rVert) \cdot [x_i \not= x_j] 
$$

Условия субмодулярности, очевидно, выполняются, т.к. $ \Theta_{ij}(0, 0) = \Theta_{ij}(1, 1) = 0 $ и $ \Theta_{ij}(1, 0), \Theta_{ij}(0, 1) \ge 0 $

Минимизация энергии эквивалентна максимизации правдоподобия итогового коллажа, т.к.

$$
    E(\mathbf{x}) = - \log p(\mathbf{x})
$$

## г)-д)

``` src/ ``` содержит базовый класс для GraphCut с реализацией самого алгортима, на выходе которого - коллаж и маска коллажа. Также там содержатся его производные с определением системы соседства и парных потенциалов. В ``` experimets/ ``` содержатся эксперименты, где доопределяются унарные потенциалы, сжимаются входные изображения и сохраняются выход работы алгоритма. Также там производится подобор параметров потенциалов для улучшения коллажа.
